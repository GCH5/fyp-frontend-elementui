import{d as I,k as a,K as O,L as A,M as D,x as F,H as N,N as z,o as r,e as g,f as t,w as d,c as T,O as $,p as H,h as M,j as c,b as q,P as G,g as w}from"./vendor.41b27b13.js";import{A as J,a as K}from"./index.227586ab.js";import{C as Q}from"./installCanvasRenderer.e4c41bf8.js";import{_ as W}from"./index.54a7439c.js";const j=u=>(H("data-v-02e97238"),u=u(),M(),u),X={key:0},Y=j(()=>c("div",{class:"el-upload__text"},[w(" Drop file here or "),c("em",null,"click to upload")],-1)),Z=j(()=>c("div",{class:"el-upload__tip"}," video files with a size less than 500kb ",-1)),ee=w(" Upload "),oe=w(" Preview "),ae=["src"],te={key:1},se={key:2},le=w(" Processing video... "),ne=I({setup(u){const p=a(),v=a(""),b=a(""),k=a(0),U=a(0),s=a("initial"),l=a(!1),x=a(),C=a([]);let n;O(()=>{l.value&&URL.revokeObjectURL(v.value)});function P(e){x.value.pause(),e()}async function V(){s.value="uploading";const e=new FormData;e.set("video",n,`${k.value}.${n.name.split(".").pop()}`);const o=await K({url:`${Q.API_HOST}/crowd-counting/analyze-video`,data:e,method:"post",responseType:"arraybuffer",onUploadProgress:function(h){const S=h.loaded/h.total*100|0;U.value=S,S===100&&(s.value="processing")}}),i=parseInt(o.headers["json-size"]),_=o.data,f=new Uint8Array(_,0,i),y=new Uint8Array(_,i),m=new Blob([y]);b.value=URL.createObjectURL(m),C.value=JSON.parse(new TextDecoder("utf-8").decode(f)),s.value="finished"}function L(){if(!n){alert("Please upload a video!");return}l.value=!l.value}const R=e=>{var o,i;(o=p.value)==null||o.clearFiles(),(i=p.value)==null||i.handleStart(e[0])},E=()=>{var e;if(!n){alert("Please upload a video!");return}(e=p.value)==null||e.submit()};function B(e,o){l.value&&URL.revokeObjectURL(v.value),l.value=!1,n=e.raw,k.value=n.uid,v.value=URL.createObjectURL(n)}return(e,o)=>{const i=A,_=D,f=F,y=N,m=z;return r(),g("div",null,[s.value==="initial"?(r(),g("div",X,[t(_,{ref_key:"upload",ref:p,accept:"video/*",class:"upload-demo",drag:"",limit:1,"on-exceed":R,"on-change":B,"auto-upload":!1,"http-request":V,action:"#"},{default:d(()=>[c("div",null,[t(i,{class:"el-icon--upload"},{default:d(()=>[t(q(G))]),_:1}),Y])]),_:1},512),Z,t(f,{type:"primary",round:"",onClick:E},{default:d(()=>[ee]),_:1}),t(f,{type:"primary",round:"",onClick:L},{default:d(()=>[oe]),_:1}),t(y,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=h=>l.value=h),width:"95%",title:"Preview","before-close":P},{default:d(()=>[c("video",{id:"videoPreview",ref_key:"videoElt",ref:x,src:v.value,controls:""},null,8,ae)]),_:1},8,["modelValue"])])):s.value==="uploading"?(r(),g("div",te,[t(m,{type:"circle",percentage:U.value,indeterminate:!0},null,8,["percentage"])])):s.value==="processing"?(r(),g("div",se,[t(m,{type:"line",percentage:50,indeterminate:!0,"stroke-width":20,duration:5},{default:d(()=>[le]),_:1})])):s.value==="finished"?(r(),T(J,{key:3,"results-video-src":b.value,"results-data":C.value},null,8,["results-video-src","results-data"])):$("",!0)])}}});var ue=W(ne,[["__scopeId","data-v-02e97238"]]);export{ue as default};
