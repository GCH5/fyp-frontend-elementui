import{_ as j,f as A,r as t,l as D,p as F,g as O,o as r,c as g,b as a,w as d,q as z,s as N,t as T,v as $,d as c,u as q,h as w}from"./index.b20752f7.js";import{E as G,a as H,A as J,b as M,u as K}from"./index.829b99b9.js";import{E as Q,C as W}from"./installCanvasRenderer.fa657d9d.js";const E=u=>(T("data-v-02e97238"),u=u(),$(),u),X={key:0},Y=E(()=>c("div",{class:"el-upload__text"},[w(" Drop file here or "),c("em",null,"click to upload")],-1)),Z=E(()=>c("div",{class:"el-upload__tip"}," video files with a size less than 500kb ",-1)),ee=w(" Upload "),oe=w(" Preview "),te=["src"],ae={key:1},le={key:2},se=w(" Processing video... "),ne=A({setup(u){const p=t(),v=t(""),U=t(""),k=t(0),b=t(0),l=t("initial"),s=t(!1),C=t(),S=t([]);let n;D(()=>{s.value&&URL.revokeObjectURL(v.value)});function V(e){C.value.pause(),e()}async function P(){l.value="uploading";const e=new FormData;e.set("video",n,`${k.value}.${n.name.split(".").pop()}`);const o=await M({url:`${W.API_HOST}/crowd-counting/analyze-video`,data:e,method:"post",responseType:"arraybuffer",onUploadProgress:function(h){const x=h.loaded/h.total*100|0;b.value=x,x===100&&(l.value="processing")}}),i=parseInt(o.headers["json-size"]),_=o.data,f=new Uint8Array(_,0,i),y=new Uint8Array(_,i),m=new Blob([y]);U.value=URL.createObjectURL(m),S.value=JSON.parse(new TextDecoder("utf-8").decode(f)),l.value="finished"}function L(){if(!n){alert("Please upload a video!");return}s.value=!s.value}const R=e=>{var o,i;(o=p.value)==null||o.clearFiles(),(i=p.value)==null||i.handleStart(e[0])},B=()=>{var e;if(!n){alert("Please upload a video!");return}(e=p.value)==null||e.submit()};function I(e,o){s.value&&URL.revokeObjectURL(v.value),s.value=!1,n=e.raw,k.value=n.uid,v.value=URL.createObjectURL(n)}return(e,o)=>{const i=F,_=G,f=O,y=Q,m=H;return r(),g("div",null,[l.value==="initial"?(r(),g("div",X,[a(_,{ref_key:"upload",ref:p,accept:"video/*",class:"upload-demo",drag:"",limit:1,"on-exceed":R,"on-change":I,"auto-upload":!1,"http-request":P,action:"#"},{default:d(()=>[c("div",null,[a(i,{class:"el-icon--upload"},{default:d(()=>[a(q(K))]),_:1}),Y])]),_:1},512),Z,a(f,{type:"primary",round:"",onClick:B},{default:d(()=>[ee]),_:1}),a(f,{type:"primary",round:"",onClick:L},{default:d(()=>[oe]),_:1}),a(y,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=h=>s.value=h),width:"95%",title:"Preview","before-close":V},{default:d(()=>[c("video",{id:"videoPreview",ref_key:"videoElt",ref:C,src:v.value,controls:""},null,8,te)]),_:1},8,["modelValue"])])):l.value==="uploading"?(r(),g("div",ae,[a(m,{type:"circle",percentage:b.value,indeterminate:!0},null,8,["percentage"])])):l.value==="processing"?(r(),g("div",le,[a(m,{type:"line",percentage:50,indeterminate:!0,"stroke-width":20,duration:5},{default:d(()=>[se]),_:1})])):l.value==="finished"?(r(),z(J,{key:3,"results-video-src":U.value,"results-data":S.value},null,8,["results-video-src","results-data"])):N("",!0)])}}});var ce=j(ne,[["__scopeId","data-v-02e97238"]]);export{ce as default};
